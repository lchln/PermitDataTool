import json
import pandas as pd
from sodapy import Socrata

# od_api = 'https://data.calgary.ca/resource/c2es-76ed.json?WorkClassMapped=New$limit=2000'
od_portal = 'data.calgary.ca'
od_key = 'c2es-76ed'
od_limit = 400000


def main():
    client = Socrata(od_portal, None)
    results = client.get(od_key, limit=od_limit)

    results_df = pd.DataFrame.from_records(results)

    jsave(results_df)


def jprint(obj):
    text = json.dumps(obj, sort_keys=True, indent=4)
    print(text)


def jsave(obj):
    obj.to_csv('test.csv', index=False)


if __name__ == '__main__':
    main()
